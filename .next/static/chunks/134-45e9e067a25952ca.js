(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[134],{4750:function(){},5800:function(t,e,a){"use strict";async function i(){try{let t=await fetch("/api/auth/session");if(!t.ok)return null;return await t.json()}catch(t){return null}}async function r(){let t=await i();if(!t)throw window.location.href="/login",Error("Authentication required");return t}async function n(t){let e=await r();if(!t.includes(e.user.role))throw window.location.href="/dashboard",Error("Insufficient permissions");return e}a.d(e,{Hw:function(){return n},Ss:function(){return i}})},7293:function(t,e,a){"use strict";a.d(e,{Up:function(){return f},WN:function(){return w},fN:function(){return u},ut:function(){return d}});var i=a(8179),r=a.n(i),n=a(7513),s=a.n(n),c=a(920),l=a(357);if(void 0===globalThis.fetch)try{let t=a(2259);globalThis.fetch=t.default||t,globalThis.Headers=t.Headers,globalThis.Request=t.Request,globalThis.Response=t.Response}catch(t){console.warn("node-fetch not available, using fallback"),globalThis.fetch=async()=>({ok:!1,json:async()=>({}),text:async()=>""})}let o=new(r())(l.env.REPLIT_DB_URL),u={async create(t){let e={...t,id:(0,c.Z)(),createdAt:new Date().toISOString(),status:"pending"};return await o.set("report:".concat(t.productId,":").concat(e.id),e),e},async getByProduct(t){let e=await o.list("report:".concat(t,":")),a=[];for(let t of e){let e=await o.get(t);e&&a.push(e)}return a.sort((t,e)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())},async getAll(){let t=await o.list("report:"),e=[];for(let a of t){let t=await o.get(a);t&&e.push(t)}return e.sort((t,e)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())},async update(t,e,a){let i=await o.get("report:".concat(t,":").concat(e));if(!i)return null;let r={...i,...a};return await o.set("report:".concat(t,":").concat(e),r),r}},d={async create(t,e){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"buyer",i=arguments.length>3?arguments[3]:void 0;if(await o.get("user:".concat(t)))throw Error("User already exists");let r=e?await s().hash(e,10):void 0,n={id:(0,c.Z)(),email:t,passwordHash:r,role:a,is_verified:(null==i?void 0:i.is_verified)||!1,createdAt:new Date().toISOString(),notifyOrder:!0,notifyStatus:!0,notifyMarketing:!1,twoFactorEnabled:"admin"===a,bookmarks:[],...i};return await o.set("user:".concat(t),n),n},findByEmail:async t=>await o.get("user:".concat(t)),async verifyPassword(t,e){let a=await this.findByEmail(t);return a&&await s().compare(e,a.passwordHash)?a:null},async updateVerificationStatus(t,e){let a=await this.findByEmail(t);a&&(a.is_verified=e,await o.set("user:".concat(t),a))},async getAll(){let t=await o.list("user:"),e=[];for(let a of t){let t=await o.get(a);t&&e.push(t)}return e},async findById(t){for(let e of(await o.list("user:"))){let a=await o.get(e);if(a&&a.id===t)return a}return null},async updateUser(t,e){let a=await this.findByEmail(t);if(a){let i={...a,...e};return await o.set("user:".concat(t),i),i}return null},async addBookmark(t,e){let a=await this.findById(t);if(a){let t=a.bookmarks||[];t.includes(e)||(t.push(e),await this.updateUser(a.email,{bookmarks:t}))}},async removeBookmark(t,e){let a=await this.findById(t);if(a){let t=(a.bookmarks||[]).filter(t=>t!==e);await this.updateUser(a.email,{bookmarks:t})}},async verify(t){await this.findByEmail(t)&&await this.updateUser(t,{is_verified:!0})},async suspend(t){await this.findByEmail(t)&&await this.updateUser(t,{status:"suspended"})},async activate(t){await this.findByEmail(t)&&await this.updateUser(t,{status:"active"})},async getUnverifiedSellers(){return(await this.getAll()).filter(t=>"seller"===t.role&&!t.is_verified)}},f={async create(t){let e={...t,id:(0,c.Z)(),createdAt:new Date().toISOString(),tags:t.tags||[],stock:t.stock||null};return await o.set("product:".concat(e.id),e),e},findById:async t=>await o.get("product:".concat(t)),async findByMerchant(t){let e=await o.list("product:"),a=[];for(let i of e){let e=await o.get(i);e&&e.merchantId===t&&a.push(e)}return a},async getAll(){let t=await o.list("product:"),e=[];for(let a of t){let t=await o.get(a);if(t&&"active"===t.status){let a=await this.getMerchantById(t.merchantId);a&&a.is_verified&&e.push(t)}}return e},async getAllForPublic(){let t=await o.list("product:"),e=[];for(let a of t){let t=await o.get(a);if(t&&"active"===t.status){let a=await this.getMerchantById(t.merchantId);a&&a.is_verified&&e.push(t)}}return e},getMerchantById:async t=>await d.findById(t),async update(t,e){let a=await this.findById(t);if(!a)return null;let i={...a,...e};return await o.set("product:".concat(t),i),i},async getRecommendations(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,a=await this.findById(t);return a&&a.tags&&0!==a.tags.length?(await this.getAllForPublic()).filter(e=>e.id!==t).filter(t=>t.tags&&t.tags.some(t=>a.tags.includes(t))).slice(0,e):[]},async getProducts(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];let t=arguments.length>1?arguments[1]:void 0;return t&&[].push(t),[]}},w={async getAll(){let t=await o.list("category:"),e=[];for(let a of t){let t=await o.get(a);t&&e.push(t)}return e},async create(t){let e={...t,id:(0,c.Z)()};return await o.set("category:".concat(e.id),e),e},async update(t,e){let a=await o.get("category:".concat(t));if(!a)return null;let i={...a,...e};return await o.set("category:".concat(t),i),i},delete:async t=>!!await o.get("category:".concat(t))&&(await o.delete("category:".concat(t)),!0),async archive(t){let e=await o.get("category:".concat(t));if(!e)return!1;let a={...e,archived:!0};return await o.set("category:".concat(t),a),!0}}}}]);