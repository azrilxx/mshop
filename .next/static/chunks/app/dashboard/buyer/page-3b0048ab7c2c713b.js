(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[521],{1623:function(e,s,t){Promise.resolve().then(t.bind(t,7442))},7442:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return o}});var a=t(7437),r=t(2265),l=t(6463),i=t(4799),n=t(6847),d=t(5800);function o(){let[e,s]=(0,r.useState)(null),[t,o]=(0,r.useState)([]),[c,m]=(0,r.useState)([]),[u,x]=(0,r.useState)(!0),[h,b]=(0,r.useState)(""),[p,g]=(0,r.useState)("rfqs"),f=(0,l.useRouter)();(0,r.useEffect)(()=>{!async function(){try{let e=await (0,d.Hw)(["buyer"]);s(e.user);let t=await fetch("/api/rfq?buyerId=".concat(e.user.id));if(t.ok){let e=await t.json();o(e)}if(e.user.bookmarks&&e.user.bookmarks.length>0){let s=e.user.bookmarks.map(async e=>{let s=await fetch("/api/products?id=".concat(e));return s.ok?(await s.json()).find(s=>s.id===e):null}),t=await Promise.all(s);m(t.filter(Boolean))}}catch(e){b(e.message)}finally{x(!1)}}()},[f]);let j=async e=>{try{(await fetch("/api/user/bookmarks",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({productId:e})})).ok&&m(s=>s.filter(s=>s.id!==e))}catch(e){console.error("Failed to remove bookmark:",e)}};return u?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(i.default,{user:e}),(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,a.jsxs)("div",{className:"animate-pulse",children:[(0,a.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-6"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded"})]})]})})]}):h?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(i.default,{user:e}),(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:[(0,a.jsx)("h3",{className:"text-red-800 font-medium",children:"Error"}),(0,a.jsx)("p",{className:"text-red-700 mt-1",children:h})]})})]}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(i.default,{user:e}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Buyer Dashboard"}),(0,a.jsxs)("p",{className:"mt-2 text-gray-600",children:["Welcome back, ",null==e?void 0:e.email,". Track your quote requests and saved products."]})]}),(0,a.jsx)("div",{className:"border-b border-gray-200 mb-6",children:(0,a.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[(0,a.jsxs)("button",{onClick:()=>g("rfqs"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("rfqs"===p?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:["Quote Requests (",t.length,")"]}),(0,a.jsxs)("button",{onClick:()=>g("bookmarks"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("bookmarks"===p?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:["Saved Products (",c.length,")"]})]})}),"rfqs"===p&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Your Quote Requests"}),0===t.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,a.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No quote requests"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Start by browsing products and requesting quotes."}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)("button",{onClick:()=>f.push("/products"),className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:"Browse Products"})})]}):(0,a.jsx)("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:(0,a.jsx)("ul",{className:"divide-y divide-gray-200",children:t.map(e=>(0,a.jsx)("li",{className:"px-6 py-4",children:(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-blue-600 truncate",children:["Product ID: ",e.productId]}),(0,a.jsx)("div",{className:"ml-2 flex-shrink-0 flex",children:(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 rounded-full",children:"Pending"})})]}),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Quantity:"})," ",e.quantity]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Region:"})," ",e.region]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Submitted:"})," ",new Date(e.submittedAt).toLocaleDateString()]})]}),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("span",{className:"font-medium text-sm text-gray-600",children:"Message:"}),(0,a.jsx)("p",{className:"text-sm text-gray-900 mt-1",children:e.message})]})]})]})})},e.id))})})]}),"bookmarks"===p&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Saved Products"}),0===c.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})}),(0,a.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No saved products"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Save products for later by clicking the bookmark icon on product cards."}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)("button",{onClick:()=>f.push("/products"),className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:"Browse Products"})})]}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map(e=>(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(n.default,{product:e}),(0,a.jsx)("button",{onClick:()=>j(e.id),className:"absolute top-2 right-2 p-1 bg-red-100 text-red-600 rounded-full hover:bg-red-200",title:"Remove bookmark",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]},e.id))})]})]})]})}},6847:function(e,s,t){"use strict";t.d(s,{default:function(){return n}});var a=t(7437),r=t(2265),l=t(7138),i=t(5800);function n(e){let{product:s}=e,[t,n]=(0,r.useState)(null),[d,o]=(0,r.useState)(!1),[c,m]=(0,r.useState)(!1);(0,r.useEffect)(()=>{!async function(){var e;let t=await (0,i.Ss)();n((null==t?void 0:t.user)||null),(null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.bookmarks)&&o(t.user.bookmarks.includes(s.id))}()},[s.id]);let u=async e=>{if(e.preventDefault(),e.stopPropagation(),t&&"buyer"===t.role){m(!0);try{(await fetch("/api/user/bookmarks",{method:d?"DELETE":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productId:s.id})})).ok&&o(!d)}catch(e){console.error("Bookmark error:",e)}finally{m(!1)}}};return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(l.default,{href:"/product/".concat(s.id),children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow",children:[s.images&&s.images.length>0&&(0,a.jsx)("img",{src:s.images[0],alt:s.name,className:"w-full h-48 object-cover"}),(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2 line-clamp-2",children:s.name}),(0,a.jsx)("p",{className:"text-gray-600 text-sm mb-2 line-clamp-2",children:s.description}),s.tags&&s.tags.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-1 mb-2",children:s.tags.slice(0,3).map((e,s)=>(0,a.jsx)("span",{className:"bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded",children:e},s))}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"text-lg font-bold text-blue-600",children:["$",s.price.toLocaleString()]}),null!==s.stock&&(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:s.stock>0?"".concat(s.stock," in stock"):"Out of stock"})]}),(0,a.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded-md text-sm hover:bg-blue-700",children:"View Details"})]})]})]})}),(null==t?void 0:t.role)==="buyer"&&(0,a.jsx)("button",{onClick:u,disabled:c,className:"absolute top-2 right-2 p-2 rounded-full transition-colors ".concat(d?"bg-blue-600 text-white":"bg-white text-gray-400 hover:text-gray-600"," shadow-md hover:shadow-lg disabled:opacity-50"),title:d?"Remove from saved":"Save for later",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z",clipRule:"evenodd"})})})]})}},5800:function(e,s,t){"use strict";async function a(){try{let e=await fetch("/api/auth/session");if(!e.ok)return null;return await e.json()}catch(e){return null}}async function r(){let e=await a();if(!e)throw window.location.href="/login",Error("Authentication required");return e}async function l(e){let s=await r();if(!e.includes(s.user.role))throw window.location.href="/dashboard",Error("Insufficient permissions");return s}t.d(s,{Hw:function(){return l},Ss:function(){return a}})}},function(e){e.O(0,[231,799,971,23,744],function(){return e(e.s=1623)}),_N_E=e.O()}]);