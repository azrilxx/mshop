"use strict";(()=>{var t={};t.id=453,t.ids=[453],t.modules={2934:t=>{t.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:t=>{t.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:t=>{t.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:t=>{t.exports=require("crypto")},7147:t=>{t.exports=require("fs")},3685:t=>{t.exports=require("http")},5687:t=>{t.exports=require("https")},5477:t=>{t.exports=require("punycode")},2781:t=>{t.exports=require("stream")},7310:t=>{t.exports=require("url")},9796:t=>{t.exports=require("zlib")},9469:(t,e,a)=>{a.r(e),a.d(e,{originalPathname:()=>y,patchFetch:()=>h,requestAsyncStorage:()=>g,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>f});var r={};a.r(r),a.d(r,{DELETE:()=>w,GET:()=>c,POST:()=>l});var i=a(9303),n=a(8716),s=a(670),o=a(7070),u=a(9487),d=a(9178);async function c(t){try{let t=await (0,d.mk)(),e=await u.Zd.get(t.id),a=await Promise.all(e.items.map(async t=>{let e=await u.Up.findById(t.productId);return{...t,product:e}}));return o.NextResponse.json({items:a,updatedAt:e.updatedAt})}catch(t){return o.NextResponse.json({error:t.message||"Failed to fetch cart"},{status:500})}}async function l(t){try{let e=await (0,d.mk)(),{productId:a,quantity:r}=await t.json();if(!a||!r)return o.NextResponse.json({error:"Product ID and quantity are required"},{status:400});if(!await u.Up.findById(a))return o.NextResponse.json({error:"Product not found"},{status:404});return await u.Zd.addItem(e.id,a,r),o.NextResponse.json({message:"Item added to cart"})}catch(t){return o.NextResponse.json({error:t.message||"Failed to add item to cart"},{status:500})}}async function w(t){try{let e=await (0,d.mk)(),{searchParams:a}=new URL(t.url),r=a.get("productId");if(!r)return o.NextResponse.json({error:"Product ID is required"},{status:400});return await u.Zd.removeItem(e.id,r),o.NextResponse.json({message:"Item removed from cart"})}catch(t){return o.NextResponse.json({error:t.message||"Failed to remove item from cart"},{status:500})}}let p=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/cart/route",pathname:"/api/cart",filename:"route",bundlePath:"app/api/cart/route"},resolvedPagePath:"/home/runner/workspace/app/api/cart/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:f,serverHooks:m}=p,y="/api/cart/route";function h(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:f})}},9178:(t,e,a)=>{a.d(e,{Gg:()=>n,MH:()=>u,SO:()=>s,ed:()=>i,mk:()=>o});var r=a(1615);async function i(t){let e={user:t,expires:new Date(Date.now()+6048e5).toISOString()};(0,r.cookies)().set("session",JSON.stringify(e),{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800})}async function n(){let t=(0,r.cookies)().get("session");if(!t)return null;try{let e=JSON.parse(t.value);if(new Date(e.expires)<new Date)return await s(),null;return e}catch{return null}}async function s(){(0,r.cookies)().delete("session")}async function o(){let t=await n();if(!t)throw Error("Authentication required");return t.user}async function u(t){let e=await o();if(!t.includes(e.role))throw Error("Insufficient permissions");return e}},9487:(t,e,a)=>{a.d(e,{Kl:()=>m,SB:()=>f,Tb:()=>g,Up:()=>c,Yf:()=>p,Zd:()=>w,ir:()=>y,ut:()=>d,wQ:()=>l});var r=a(741),i=a.n(r),n=a(2023),s=a.n(n),o=a(9576);let u=new(i()),d={async create(t,e,a){if(await u.get(`user:${t}`))throw Error("User already exists");let r={id:(0,o.Z)(),email:t,passwordHash:await s().hash(e,10),role:a,is_verified:"admin"===a,createdAt:new Date().toISOString()};return await u.set(`user:${t}`,r),r},findByEmail:async t=>await u.get(`user:${t}`),async verifyPassword(t,e){let a=await this.findByEmail(t);return a&&await s().compare(e,a.passwordHash)?a:null},async updateVerificationStatus(t,e){let a=await this.findByEmail(t);a&&(a.is_verified=e,await u.set(`user:${t}`,a))},async getAll(){let t=await u.list("user:"),e=[];for(let a of t){let t=await u.get(a);t&&e.push(t)}return e},async findById(t){for(let e of(await u.list("user:"))){let a=await u.get(e);if(a&&a.id===t)return a}return null}},c={async create(t){let e={...t,id:(0,o.Z)(),createdAt:new Date().toISOString()};return await u.set(`product:${e.id}`,e),e},findById:async t=>await u.get(`product:${t}`),async findByMerchant(t){let e=await u.list("product:"),a=[];for(let r of e){let e=await u.get(r);e&&e.merchantId===t&&a.push(e)}return a},async getAll(){let t=await u.list("product:"),e=[];for(let a of t){let t=await u.get(a);if(t&&"active"===t.status){let a=await this.getMerchantById(t.merchantId);a&&a.is_verified&&e.push(t)}}return e},async getAllForPublic(){let t=await u.list("product:"),e=[];for(let a of t){let t=await u.get(a);if(t&&"active"===t.status){let a=await this.getMerchantById(t.merchantId);a&&a.is_verified&&e.push(t)}}return e},getMerchantById:async t=>await d.findById(t),async update(t,e){let a=await this.findById(t);if(!a)return null;let r={...a,...e};return await u.set(`product:${t}`,r),r}},l={async create(t){let e={...t,id:(0,o.Z)(),createdAt:new Date().toISOString()};return await u.set(`order:${e.id}`,e),e},findById:async t=>await u.get(`order:${t}`),async findByBuyer(t){let e=await u.list("order:"),a=[];for(let r of e){let e=await u.get(r);e&&e.buyerId===t&&a.push(e)}return a},async getAll(){let t=await u.list("order:"),e=[];for(let a of t){let t=await u.get(a);t&&e.push(t)}return e},async update(t,e){let a=await this.findById(t);if(!a)return null;let r={...a,...e};return await u.set(`order:${t}`,r),r},async findBySeller(t){let e=await u.list("order:"),a=[];for(let r of e){let e=await u.get(r);e&&(await Promise.all(e.productIds.map(t=>c.findById(t)))).some(e=>e&&e.merchantId===t)&&a.push(e)}return a}},w={get:async t=>await u.get(`cart:${t}`)||{items:[],updatedAt:new Date().toISOString()},async update(t,e){e.updatedAt=new Date().toISOString(),await u.set(`cart:${t}`,e)},async addItem(t,e,a=1){let r=await this.get(t),i=r.items.find(t=>t.productId===e);i?i.quantity+=a:r.items.push({productId:e,quantity:a}),await this.update(t,r)},async removeItem(t,e){let a=await this.get(t);a.items=a.items.filter(t=>t.productId!==e),await this.update(t,a)},async clear(t){await u.set(`cart:${t}`,{items:[],updatedAt:new Date().toISOString()})},async getAbandonedCarts(){let t=await u.list("cart:"),e=[],a=new Date(Date.now()-864e5);for(let r of t){let t=await u.get(r);if(t&&t.items.length>0&&!t.reminderSent&&new Date(t.updatedAt)<a){let a=r.replace("cart:","");e.push({userId:a,cart:t})}}return e}},p={async create(t,e="Free"){let a={userId:t,tier:e,...{Free:{maxProducts:20,maxAdSlots:0,customerSupport:!1},Standard:{maxProducts:60,maxAdSlots:12,customerSupport:!0},Premium:{maxProducts:-1,maxAdSlots:-1,customerSupport:!0}}[e],quotaUsed:0,adSlotsUsed:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await u.set(`plan:${t}`,a),a},async get(t){return await u.get(`plan:${t}`)||await this.create(t,"Free")},async update(t,e){let a={...await this.get(t),...e,updatedAt:new Date().toISOString()};return await u.set(`plan:${t}`,a),a},async incrementQuota(t){let e=await this.get(t);e.quotaUsed+=1,await this.update(t,{quotaUsed:e.quotaUsed})},async decrementQuota(t){let e=await this.get(t);e.quotaUsed>0&&(e.quotaUsed-=1,await this.update(t,{quotaUsed:e.quotaUsed}))}},g={async create(t){let e={...t,id:(0,o.Z)(),createdAt:new Date().toISOString()};return await u.set(`ad:${e.id}`,e),e},findById:async t=>await u.get(`ad:${t}`),async findBySeller(t){let e=await u.list("ad:"),a=[];for(let r of e){let e=await u.get(r);e&&e.sellerId===t&&a.push(e)}return a},async getActiveAds(){let t=await u.list("ad:"),e=[],a=new Date;for(let r of t){let t=await u.get(r);t&&"active"===t.status&&new Date(t.activeFrom)<=a&&new Date(t.activeUntil)>=a&&e.push(t)}return e},async update(t,e){let a=await this.findById(t);if(!a)return null;let r={...a,...e};return await u.set(`ad:${t}`,r),r}},f={async create(t){let e={...t,status:"pending",submittedAt:new Date().toISOString()};return await u.set(`verification:${t.userId}`,e),e},get:async t=>await u.get(`verification:${t}`),async update(t,e){let a=await this.get(t);if(!a)return null;let r={...a,...e};return e.status&&"pending"!==e.status&&(r.reviewedAt=new Date().toISOString()),await u.set(`verification:${t}`,r),r},async getAll(){let t=await u.list("verification:"),e=[];for(let a of t){let t=await u.get(a);t&&e.push(t)}return e}},m={async create(t){let e={...t,createdAt:new Date().toISOString()};return await u.set(`rating:${t.productId}:${t.userId}`,e),e},get:async(t,e)=>await u.get(`rating:${t}:${e}`),async getByProduct(t){let e=await u.list(`rating:${t}:`),a=[];for(let t of e){let e=await u.get(t);e&&a.push(e)}return a},async getAverageRating(t){let e=await this.getByProduct(t);return 0===e.length?{average:0,count:0}:{average:Number((e.reduce((t,e)=>t+e.rating,0)/e.length).toFixed(1)),count:e.length}}},y={async create(t){let e={...t,id:(0,o.Z)(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await u.set(`comment:${e.id}`,e),e},async getByProduct(t){let e=await u.list("comment:"),a=[];for(let r of e){let e=await u.get(r);e&&e.productId===t&&a.push(e)}return a.sort((t,e)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())},async getReplies(t){let e=await u.list("comment:"),a=[];for(let r of e){let e=await u.get(r);e&&e.parentId===t&&a.push(e)}return a.sort((t,e)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime())},async update(t,e){let a=await u.get(`comment:${t}`);if(!a)return null;let r={...a,...e,updatedAt:new Date().toISOString()};return await u.set(`comment:${t}`,r),r},async delete(t){if(!await u.get(`comment:${t}`))return!1;for(let e of(await this.getReplies(t)))await u.delete(`comment:${e.id}`);return await u.delete(`comment:${t}`),!0}}}};var e=require("../../../webpack-runtime.js");e.C(t);var a=t=>e(e.s=t),r=e.X(0,[276,615,701,972],()=>a(9469));module.exports=r})();