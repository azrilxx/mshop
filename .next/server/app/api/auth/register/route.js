"use strict";(()=>{var t={};t.id=2,t.ids=[2],t.modules={2934:t=>{t.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:t=>{t.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:t=>{t.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:t=>{t.exports=require("crypto")},7147:t=>{t.exports=require("fs")},3685:t=>{t.exports=require("http")},5687:t=>{t.exports=require("https")},5477:t=>{t.exports=require("punycode")},2781:t=>{t.exports=require("stream")},7310:t=>{t.exports=require("url")},9796:t=>{t.exports=require("zlib")},1175:(t,e,a)=>{a.r(e),a.d(e,{originalPathname:()=>f,patchFetch:()=>y,requestAsyncStorage:()=>w,routeModule:()=>c,serverHooks:()=>g,staticGenerationAsyncStorage:()=>p});var r={};a.r(r),a.d(r,{POST:()=>l});var i=a(9303),n=a(8716),s=a(670),u=a(7070),o=a(9487),d=a(9178);async function l(t){try{let{email:e,password:a,role:r}=await t.json();if(!e||!a||!r)return u.NextResponse.json({error:"Email, password, and role are required"},{status:400});if(!["buyer","seller","admin"].includes(r))return u.NextResponse.json({error:"Invalid role"},{status:400});let i=await o.ut.create(e,a,r);return await (0,d.ed)(i),u.NextResponse.json({message:"User created successfully",user:{id:i.id,email:i.email,role:i.role}},{status:201})}catch(t){return u.NextResponse.json({error:t.message||"Registration failed"},{status:400})}}let c=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/register/route",pathname:"/api/auth/register",filename:"route",bundlePath:"app/api/auth/register/route"},resolvedPagePath:"/home/runner/workspace/app/api/auth/register/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:w,staticGenerationAsyncStorage:p,serverHooks:g}=c,f="/api/auth/register/route";function y(){return(0,s.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:p})}},9178:(t,e,a)=>{a.d(e,{Gg:()=>n,MH:()=>o,SO:()=>s,ed:()=>i,mk:()=>u});var r=a(1615);async function i(t){let e={user:t,expires:new Date(Date.now()+6048e5).toISOString()};(0,r.cookies)().set("session",JSON.stringify(e),{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800})}async function n(){let t=(0,r.cookies)().get("session");if(!t)return null;try{let e=JSON.parse(t.value);if(new Date(e.expires)<new Date)return await s(),null;return e}catch{return null}}async function s(){(0,r.cookies)().delete("session")}async function u(){let t=await n();if(!t)throw Error("Authentication required");return t.user}async function o(t){let e=await u();if(!t.includes(e.role))throw Error("Insufficient permissions");return e}},9487:(t,e,a)=>{a.d(e,{Kl:()=>y,SB:()=>f,Tb:()=>g,Up:()=>l,Yf:()=>p,Zd:()=>w,ir:()=>m,ut:()=>d,wQ:()=>c});var r=a(741),i=a.n(r),n=a(2023),s=a.n(n),u=a(9576);let o=new(i()),d={async create(t,e,a){if(await o.get(`user:${t}`))throw Error("User already exists");let r={id:(0,u.Z)(),email:t,passwordHash:await s().hash(e,10),role:a,is_verified:"admin"===a,createdAt:new Date().toISOString()};return await o.set(`user:${t}`,r),r},findByEmail:async t=>await o.get(`user:${t}`),async verifyPassword(t,e){let a=await this.findByEmail(t);return a&&await s().compare(e,a.passwordHash)?a:null},async updateVerificationStatus(t,e){let a=await this.findByEmail(t);a&&(a.is_verified=e,await o.set(`user:${t}`,a))},async getAll(){let t=await o.list("user:"),e=[];for(let a of t){let t=await o.get(a);t&&e.push(t)}return e},async findById(t){for(let e of(await o.list("user:"))){let a=await o.get(e);if(a&&a.id===t)return a}return null}},l={async create(t){let e={...t,id:(0,u.Z)(),createdAt:new Date().toISOString()};return await o.set(`product:${e.id}`,e),e},findById:async t=>await o.get(`product:${t}`),async findByMerchant(t){let e=await o.list("product:"),a=[];for(let r of e){let e=await o.get(r);e&&e.merchantId===t&&a.push(e)}return a},async getAll(){let t=await o.list("product:"),e=[];for(let a of t){let t=await o.get(a);if(t&&"active"===t.status){let a=await this.getMerchantById(t.merchantId);a&&a.is_verified&&e.push(t)}}return e},async getAllForPublic(){let t=await o.list("product:"),e=[];for(let a of t){let t=await o.get(a);if(t&&"active"===t.status){let a=await this.getMerchantById(t.merchantId);a&&a.is_verified&&e.push(t)}}return e},getMerchantById:async t=>await d.findById(t),async update(t,e){let a=await this.findById(t);if(!a)return null;let r={...a,...e};return await o.set(`product:${t}`,r),r}},c={async create(t){let e={...t,id:(0,u.Z)(),createdAt:new Date().toISOString()};return await o.set(`order:${e.id}`,e),e},findById:async t=>await o.get(`order:${t}`),async findByBuyer(t){let e=await o.list("order:"),a=[];for(let r of e){let e=await o.get(r);e&&e.buyerId===t&&a.push(e)}return a},async getAll(){let t=await o.list("order:"),e=[];for(let a of t){let t=await o.get(a);t&&e.push(t)}return e},async update(t,e){let a=await this.findById(t);if(!a)return null;let r={...a,...e};return await o.set(`order:${t}`,r),r},async findBySeller(t){let e=await o.list("order:"),a=[];for(let r of e){let e=await o.get(r);e&&(await Promise.all(e.productIds.map(t=>l.findById(t)))).some(e=>e&&e.merchantId===t)&&a.push(e)}return a}},w={get:async t=>await o.get(`cart:${t}`)||{items:[],updatedAt:new Date().toISOString()},async update(t,e){e.updatedAt=new Date().toISOString(),await o.set(`cart:${t}`,e)},async addItem(t,e,a=1){let r=await this.get(t),i=r.items.find(t=>t.productId===e);i?i.quantity+=a:r.items.push({productId:e,quantity:a}),await this.update(t,r)},async removeItem(t,e){let a=await this.get(t);a.items=a.items.filter(t=>t.productId!==e),await this.update(t,a)},async clear(t){await o.set(`cart:${t}`,{items:[],updatedAt:new Date().toISOString()})},async getAbandonedCarts(){let t=await o.list("cart:"),e=[],a=new Date(Date.now()-864e5);for(let r of t){let t=await o.get(r);if(t&&t.items.length>0&&!t.reminderSent&&new Date(t.updatedAt)<a){let a=r.replace("cart:","");e.push({userId:a,cart:t})}}return e}},p={async create(t,e="Free"){let a={userId:t,tier:e,...{Free:{maxProducts:20,maxAdSlots:0,customerSupport:!1},Standard:{maxProducts:60,maxAdSlots:12,customerSupport:!0},Premium:{maxProducts:-1,maxAdSlots:-1,customerSupport:!0}}[e],quotaUsed:0,adSlotsUsed:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await o.set(`plan:${t}`,a),a},async get(t){return await o.get(`plan:${t}`)||await this.create(t,"Free")},async update(t,e){let a={...await this.get(t),...e,updatedAt:new Date().toISOString()};return await o.set(`plan:${t}`,a),a},async incrementQuota(t){let e=await this.get(t);e.quotaUsed+=1,await this.update(t,{quotaUsed:e.quotaUsed})},async decrementQuota(t){let e=await this.get(t);e.quotaUsed>0&&(e.quotaUsed-=1,await this.update(t,{quotaUsed:e.quotaUsed}))}},g={async create(t){let e={...t,id:(0,u.Z)(),createdAt:new Date().toISOString()};return await o.set(`ad:${e.id}`,e),e},findById:async t=>await o.get(`ad:${t}`),async findBySeller(t){let e=await o.list("ad:"),a=[];for(let r of e){let e=await o.get(r);e&&e.sellerId===t&&a.push(e)}return a},async getActiveAds(){let t=await o.list("ad:"),e=[],a=new Date;for(let r of t){let t=await o.get(r);t&&"active"===t.status&&new Date(t.activeFrom)<=a&&new Date(t.activeUntil)>=a&&e.push(t)}return e},async update(t,e){let a=await this.findById(t);if(!a)return null;let r={...a,...e};return await o.set(`ad:${t}`,r),r}},f={async create(t){let e={...t,status:"pending",submittedAt:new Date().toISOString()};return await o.set(`verification:${t.userId}`,e),e},get:async t=>await o.get(`verification:${t}`),async update(t,e){let a=await this.get(t);if(!a)return null;let r={...a,...e};return e.status&&"pending"!==e.status&&(r.reviewedAt=new Date().toISOString()),await o.set(`verification:${t}`,r),r},async getAll(){let t=await o.list("verification:"),e=[];for(let a of t){let t=await o.get(a);t&&e.push(t)}return e}},y={async create(t){let e={...t,createdAt:new Date().toISOString()};return await o.set(`rating:${t.productId}:${t.userId}`,e),e},get:async(t,e)=>await o.get(`rating:${t}:${e}`),async getByProduct(t){let e=await o.list(`rating:${t}:`),a=[];for(let t of e){let e=await o.get(t);e&&a.push(e)}return a},async getAverageRating(t){let e=await this.getByProduct(t);return 0===e.length?{average:0,count:0}:{average:Number((e.reduce((t,e)=>t+e.rating,0)/e.length).toFixed(1)),count:e.length}}},m={async create(t){let e={...t,id:(0,u.Z)(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await o.set(`comment:${e.id}`,e),e},async getByProduct(t){let e=await o.list("comment:"),a=[];for(let r of e){let e=await o.get(r);e&&e.productId===t&&a.push(e)}return a.sort((t,e)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())},async getReplies(t){let e=await o.list("comment:"),a=[];for(let r of e){let e=await o.get(r);e&&e.parentId===t&&a.push(e)}return a.sort((t,e)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime())},async update(t,e){let a=await o.get(`comment:${t}`);if(!a)return null;let r={...a,...e,updatedAt:new Date().toISOString()};return await o.set(`comment:${t}`,r),r},async delete(t){if(!await o.get(`comment:${t}`))return!1;for(let e of(await this.getReplies(t)))await o.delete(`comment:${e.id}`);return await o.delete(`comment:${t}`),!0}}}};var e=require("../../../../webpack-runtime.js");e.C(t);var a=t=>e(e.s=t),r=e.X(0,[276,615,701,972],()=>a(1175));module.exports=r})();