"use strict";exports.id=4853,exports.ids=[4853],exports.modules={67269:(t,e,a)=>{async function i(){try{let t=await fetch("/api/auth/session");if(!t.ok)return null;return await t.json()}catch{return null}}async function r(){let t=await i();if(!t)throw window.location.href="/login",Error("Authentication required");return t}async function s(t){let e=await r();if(!t.includes(e.user.role))throw window.location.href="/dashboard",Error("Insufficient permissions");return e}a.d(e,{Hw:()=>s})},97012:(t,e,a)=>{a.d(e,{Up:()=>u,WN:()=>w,fN:()=>c,ut:()=>d});var i=a(87343),r=a.n(i),s=a(42528),n=a.n(s),l=a(47463);if(void 0===globalThis.fetch)try{let t=a(32490);globalThis.fetch=t.default||t,globalThis.Headers=t.Headers,globalThis.Request=t.Request,globalThis.Response=t.Response}catch(t){console.warn("node-fetch not available, using fallback"),globalThis.fetch=async()=>({ok:!1,json:async()=>({}),text:async()=>""})}let o=new(r())(process.env.REPLIT_DB_URL),c={async create(t){let e={...t,id:(0,l.Z)(),createdAt:new Date().toISOString(),status:"pending"};return await o.set(`report:${t.productId}:${e.id}`,e),e},async getByProduct(t){let e=await o.list(`report:${t}:`),a=[];for(let t of e){let e=await o.get(t);e&&a.push(e)}return a.sort((t,e)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())},async getAll(){let t=await o.list("report:"),e=[];for(let a of t){let t=await o.get(a);t&&e.push(t)}return e.sort((t,e)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())},async update(t,e,a){let i=await o.get(`report:${t}:${e}`);if(!i)return null;let r={...i,...a};return await o.set(`report:${t}:${e}`,r),r}},d={async create(t,e,a="buyer",i){if(await o.get(`user:${t}`))throw Error("User already exists");let r=e?await n().hash(e,10):void 0,s={id:(0,l.Z)(),email:t,passwordHash:r,role:a,is_verified:i?.is_verified||!1,createdAt:new Date().toISOString(),notifyOrder:!0,notifyStatus:!0,notifyMarketing:!1,twoFactorEnabled:"admin"===a,bookmarks:[],...i};return await o.set(`user:${t}`,s),s},findByEmail:async t=>await o.get(`user:${t}`),async verifyPassword(t,e){let a=await this.findByEmail(t);return a&&await n().compare(e,a.passwordHash)?a:null},async updateVerificationStatus(t,e){let a=await this.findByEmail(t);a&&(a.is_verified=e,await o.set(`user:${t}`,a))},async getAll(){let t=await o.list("user:"),e=[];for(let a of t){let t=await o.get(a);t&&e.push(t)}return e},async findById(t){for(let e of(await o.list("user:"))){let a=await o.get(e);if(a&&a.id===t)return a}return null},async updateUser(t,e){let a=await this.findByEmail(t);if(a){let i={...a,...e};return await o.set(`user:${t}`,i),i}return null},async addBookmark(t,e){let a=await this.findById(t);if(a){let t=a.bookmarks||[];t.includes(e)||(t.push(e),await this.updateUser(a.email,{bookmarks:t}))}},async removeBookmark(t,e){let a=await this.findById(t);if(a){let t=(a.bookmarks||[]).filter(t=>t!==e);await this.updateUser(a.email,{bookmarks:t})}},async verify(t){await this.findByEmail(t)&&await this.updateUser(t,{is_verified:!0})},async suspend(t){await this.findByEmail(t)&&await this.updateUser(t,{status:"suspended"})},async activate(t){await this.findByEmail(t)&&await this.updateUser(t,{status:"active"})},async getUnverifiedSellers(){return(await this.getAll()).filter(t=>"seller"===t.role&&!t.is_verified)}},u={async create(t){let e={...t,id:(0,l.Z)(),createdAt:new Date().toISOString(),tags:t.tags||[],stock:t.stock||null};return await o.set(`product:${e.id}`,e),e},findById:async t=>await o.get(`product:${t}`),async findByMerchant(t){let e=await o.list("product:"),a=[];for(let i of e){let e=await o.get(i);e&&e.merchantId===t&&a.push(e)}return a},async getAll(){let t=await o.list("product:"),e=[];for(let a of t){let t=await o.get(a);if(t&&"active"===t.status){let a=await this.getMerchantById(t.merchantId);a&&a.is_verified&&e.push(t)}}return e},async getAllForPublic(){let t=await o.list("product:"),e=[];for(let a of t){let t=await o.get(a);if(t&&"active"===t.status){let a=await this.getMerchantById(t.merchantId);a&&a.is_verified&&e.push(t)}}return e},getMerchantById:async t=>await d.findById(t),async update(t,e){let a=await this.findById(t);if(!a)return null;let i={...a,...e};return await o.set(`product:${t}`,i),i},async getRecommendations(t,e=4){let a=await this.findById(t);return a&&a.tags&&0!==a.tags.length?(await this.getAllForPublic()).filter(e=>e.id!==t).filter(t=>t.tags&&t.tags.some(t=>a.tags.includes(t))).slice(0,e):[]},getProducts:async(t={},e)=>(e&&[].push(e),[])},w={async getAll(){let t=await o.list("category:"),e=[];for(let a of t){let t=await o.get(a);t&&e.push(t)}return e},async create(t){let e={...t,id:(0,l.Z)()};return await o.set(`category:${e.id}`,e),e},async update(t,e){let a=await o.get(`category:${t}`);if(!a)return null;let i={...a,...e};return await o.set(`category:${t}`,i),i},delete:async t=>!!await o.get(`category:${t}`)&&(await o.delete(`category:${t}`),!0),async archive(t){let e=await o.get(`category:${t}`);if(!e)return!1;let a={...e,archived:!0};return await o.set(`category:${t}`,a),!0}}}};