"use strict";exports.id=9487,exports.ids=[9487],exports.modules={9487:(t,e,a)=>{a.r(e),a.d(e,{adDb:()=>h,cartDb:()=>y,categoryDb:()=>v,commentDb:()=>D,db:()=>o,default:()=>B,initializeSampleData:()=>b,insightDb:()=>A,orderDb:()=>w,planDb:()=>f,planUsageDb:()=>p,productDb:()=>u,quoteDb:()=>I,ratingDb:()=>S,reportDb:()=>d,rfqDb:()=>g,serviceDb:()=>$,userDb:()=>c,verificationDb:()=>m});var i=a(10741),r=a.n(i),n=a(42023),s=a.n(n),l=a(9576);if(void 0===globalThis.fetch)try{let t=a(10820);globalThis.fetch=t.default||t,globalThis.Headers=t.Headers,globalThis.Request=t.Request,globalThis.Response=t.Response}catch(t){console.warn("node-fetch not available, using fallback"),globalThis.fetch=async()=>({ok:!1,json:async()=>({}),text:async()=>""})}let o=new(r())(process.env.REPLIT_DB_URL),d={async create(t){let e={...t,id:(0,l.Z)(),createdAt:new Date().toISOString(),status:"pending"};return await o.set(`report:${t.productId}:${e.id}`,e),e},async getByProduct(t){let e=await o.list(`report:${t}:`),a=[];for(let t of e){let e=await o.get(t);e&&a.push(e)}return a.sort((t,e)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())},async getAll(){let t=await o.list("report:"),e=[];for(let a of t){let t=await o.get(a);t&&e.push(t)}return e.sort((t,e)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())},async update(t,e,a){let i=await o.get(`report:${t}:${e}`);if(!i)return null;let r={...i,...a};return await o.set(`report:${t}:${e}`,r),r}},c={async create(t,e,a="buyer",i){if(await o.get(`user:${t}`))throw Error("User already exists");let r=e?await s().hash(e,10):void 0,n={id:(0,l.Z)(),email:t,passwordHash:r,role:a,is_verified:i?.is_verified||!1,createdAt:new Date().toISOString(),notifyOrder:!0,notifyStatus:!0,notifyMarketing:!1,twoFactorEnabled:"admin"===a,bookmarks:[],...i};return await o.set(`user:${t}`,n),n},findByEmail:async t=>await o.get(`user:${t}`),async verifyPassword(t,e){let a=await this.findByEmail(t);return a&&await s().compare(e,a.passwordHash)?a:null},async updateVerificationStatus(t,e){let a=await this.findByEmail(t);a&&(a.is_verified=e,await o.set(`user:${t}`,a))},async getAll(){let t=await o.list("user:"),e=[];for(let a of t){let t=await o.get(a);t&&e.push(t)}return e},async findById(t){for(let e of(await o.list("user:"))){let a=await o.get(e);if(a&&a.id===t)return a}return null},async updateUser(t,e){let a=await this.findByEmail(t);if(a){let i={...a,...e};return await o.set(`user:${t}`,i),i}return null},async addBookmark(t,e){let a=await this.findById(t);if(a){let t=a.bookmarks||[];t.includes(e)||(t.push(e),await this.updateUser(a.email,{bookmarks:t}))}},async removeBookmark(t,e){let a=await this.findById(t);if(a){let t=(a.bookmarks||[]).filter(t=>t!==e);await this.updateUser(a.email,{bookmarks:t})}},async verify(t){await this.findByEmail(t)&&await this.updateUser(t,{is_verified:!0})},async suspend(t){await this.findByEmail(t)&&await this.updateUser(t,{status:"suspended"})},async activate(t){await this.findByEmail(t)&&await this.updateUser(t,{status:"active"})},async getUnverifiedSellers(){return(await this.getAll()).filter(t=>"seller"===t.role&&!t.is_verified)}},u={async create(t){let e={...t,id:(0,l.Z)(),createdAt:new Date().toISOString(),tags:t.tags||[],stock:t.stock||null};return await o.set(`product:${e.id}`,e),e},findById:async t=>await o.get(`product:${t}`),async findByMerchant(t){let e=await o.list("product:"),a=[];for(let i of e){let e=await o.get(i);e&&e.merchantId===t&&a.push(e)}return a},async getAll(){let t=await o.list("product:"),e=[];for(let a of t){let t=await o.get(a);if(t&&"active"===t.status){let a=await this.getMerchantById(t.merchantId);a&&a.is_verified&&e.push(t)}}return e},async getAllForPublic(){let t=await o.list("product:"),e=[];for(let a of t){let t=await o.get(a);if(t&&"active"===t.status){let a=await this.getMerchantById(t.merchantId);a&&a.is_verified&&e.push(t)}}return e},getMerchantById:async t=>await c.findById(t),async update(t,e){let a=await this.findById(t);if(!a)return null;let i={...a,...e};return await o.set(`product:${t}`,i),i},async getRecommendations(t,e=4){let a=await this.findById(t);return a&&a.tags&&0!==a.tags.length?(await this.getAllForPublic()).filter(e=>e.id!==t).filter(t=>t.tags&&t.tags.some(t=>a.tags.includes(t))).slice(0,e):[]},getProducts:async(t={},e)=>(e&&[].push(e),[])},g={async create(t){let e={...t,id:(0,l.Z)(),submittedAt:new Date().toISOString(),status:"submitted"};return await o.set(`rfq:${t.productId}:${e.id}`,e),e},async getByProduct(t){let e=await o.list(`rfq:${t}:`),a=[];for(let t of e){let e=await o.get(t);e&&a.push(e)}return a.sort((t,e)=>new Date(e.submittedAt).getTime()-new Date(t.submittedAt).getTime())},async getByBuyer(t){let e=await o.list("rfq:"),a=[];for(let i of e){let e=await o.get(i);e&&e.buyerId===t&&a.push(e)}return a.sort((t,e)=>new Date(e.submittedAt).getTime()-new Date(t.submittedAt).getTime())},async getBySeller(t){let e=await o.list("rfq:"),a=[];for(let i of e){let e=await o.get(i);if(e){let i=await u.findById(e.productId);i&&i.merchantId===t&&a.push(e)}}return a.sort((t,e)=>new Date(e.submittedAt).getTime()-new Date(t.submittedAt).getTime())},async updateStatus(t,e,a){let i=await o.get(`rfq:${t}:${e}`);if(!i)return null;let r={...i,status:a};return await o.set(`rfq:${t}:${e}`,r),r}},w={async create(t){let e={...t,id:(0,l.Z)(),createdAt:new Date().toISOString()};return await o.set(`order:${e.id}`,e),e},findById:async t=>await o.get(`order:${t}`),async findByBuyer(t){let e=await o.list("order:"),a=[];for(let i of e){let e=await o.get(i);e&&e.buyerId===t&&a.push(e)}return a},async getAll(){let t=await o.list("order:"),e=[];for(let a of t){let t=await o.get(a);t&&e.push(t)}return e},async update(t,e){let a=await this.findById(t);if(!a)return null;let i={...a,...e};return await o.set(`order:${t}`,i),i},async findBySeller(t){let e=await o.list("order:"),a=[];for(let i of e){let e=await o.get(i);e&&(await Promise.all(e.productIds.map(t=>u.findById(t)))).some(e=>e&&e.merchantId===t)&&a.push(e)}return a}},y={get:async t=>await o.get(`cart:${t}`)||{items:[],updatedAt:new Date().toISOString()},async update(t,e){e.updatedAt=new Date().toISOString(),await o.set(`cart:${t}`,e)},async addItem(t,e,a=1){let i=await this.get(t),r=i.items.find(t=>t.productId===e);r?r.quantity+=a:i.items.push({productId:e,quantity:a}),await this.update(t,i)},async removeItem(t,e){let a=await this.get(t);a.items=a.items.filter(t=>t.productId!==e),await this.update(t,a)},async clear(t){await o.set(`cart:${t}`,{items:[],updatedAt:new Date().toISOString()})},async getAbandonedCarts(){let t=await o.list("cart:"),e=[],a=new Date(Date.now()-864e5);for(let i of t){let t=await o.get(i);if(t&&t.items.length>0&&!t.reminderSent&&new Date(t.updatedAt)<a){let a=i.replace("cart:","");e.push({userId:a,cart:t})}}return e}},f={async create(t,e="Free"){let a={userId:t,tier:e,...{Free:{maxProducts:20,maxAdSlots:0,customerSupport:!1},Standard:{maxProducts:60,maxAdSlots:12,customerSupport:!0},Premium:{maxProducts:-1,maxAdSlots:-1,customerSupport:!0}}[e],quotaUsed:0,adSlotsUsed:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await o.set(`plan:${t}`,a),a},async get(t){return await o.get(`plan:${t}`)||await this.create(t,"Free")},async update(t,e){let a={...await this.get(t),...e,updatedAt:new Date().toISOString()};return await o.set(`plan:${t}`,a),a},async incrementQuota(t){let e=await this.get(t);e.quotaUsed+=1,await this.update(t,{quotaUsed:e.quotaUsed})},async decrementQuota(t){let e=await this.get(t);e.quotaUsed=Math.max(0,e.quotaUsed-1),await this.update(t,{quotaUsed:e.quotaUsed})}},p={async get(t){let e=new Date().toISOString().slice(0,7),a=`usage:${t}:${e}`,i=await o.get(a);return i||(i={userId:t,month:e,productsCreated:0,adsCreated:0,reportsGenerated:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},await o.set(a,i)),i},async incrementProducts(t){let e=await this.get(t);e.productsCreated+=1,e.updatedAt=new Date().toISOString();let a=new Date().toISOString().slice(0,7);await o.set(`usage:${t}:${a}`,e)},async incrementAds(t){let e=await this.get(t);e.adsCreated+=1,e.updatedAt=new Date().toISOString();let a=new Date().toISOString().slice(0,7);await o.set(`usage:${t}:${a}`,e)},async incrementReports(t){let e=await this.get(t);e.reportsGenerated+=1,e.updatedAt=new Date().toISOString();let a=new Date().toISOString().slice(0,7);await o.set(`usage:${t}:${a}`,e)},async resetForNewPlan(t){let e=new Date().toISOString().slice(0,7),a={userId:t,month:e,productsCreated:0,adsCreated:0,reportsGenerated:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};await o.set(`usage:${t}:${e}`,a)}},h={async create(t){let e={...t,id:(0,l.Z)(),createdAt:new Date().toISOString()};return await o.set(`ad:${e.id}`,e),e},findById:async t=>await o.get(`ad:${t}`),async findBySeller(t){let e=await o.list("ad:"),a=[];for(let i of e){let e=await o.get(i);e&&e.sellerId===t&&a.push(e)}return a},async getActiveAds(){let t=await o.list("ad:"),e=[],a=new Date;for(let i of t){let t=await o.get(i);t&&"active"===t.status&&new Date(t.activeFrom)<=a&&new Date(t.activeUntil)>=a&&e.push(t)}return e},async update(t,e){let a=await this.findById(t);if(!a)return null;let i={...a,...e};return await o.set(`ad:${t}`,i),i}},m={async create(t){let e={...t,status:"pending",submittedAt:new Date().toISOString()};return await o.set(`verification:${t.userId}`,e),e},get:async t=>await o.get(`verification:${t}`),async update(t,e){let a=await this.get(t);if(!a)return null;let i={...a,...e};return e.status&&"pending"!==e.status&&(i.reviewedAt=new Date().toISOString()),await o.set(`verification:${t}`,i),i},async getAll(){let t=await o.list("verification:"),e=[];for(let a of t){let t=await o.get(a);t&&e.push(t)}return e}},S={async create(t){let e={...t,createdAt:new Date().toISOString()};return await o.set(`rating:${t.productId}:${t.userId}`,e),e},get:async(t,e)=>await o.get(`rating:${t}:${e}`),async getByProduct(t){let e=await o.list(`rating:${t}:`),a=[];for(let t of e){let e=await o.get(t);e&&a.push(e)}return a},async getAverageRating(t){let e=await this.getByProduct(t);return 0===e.length?{average:0,count:0}:{average:Number((e.reduce((t,e)=>t+e.rating,0)/e.length).toFixed(1)),count:e.length}}},D={async create(t){let e={...t,id:(0,l.Z)(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await o.set(`comment:${e.id}`,e),e},async getByProduct(t){let e=await o.list("comment:"),a=[];for(let i of e){let e=await o.get(i);e&&e.productId===t&&a.push(e)}return a.sort((t,e)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())},async getReplies(t){let e=await o.list("comment:"),a=[];for(let i of e){let e=await o.get(i);e&&e.parentId===t&&a.push(e)}return a.sort((t,e)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime())},async update(t,e){let a=await o.get(`comment:${t}`);if(!a)return null;let i={...a,...e,updatedAt:new Date().toISOString()};return await o.set(`comment:${t}`,i),i},async delete(t){if(!await o.get(`comment:${t}`))return!1;for(let e of(await this.getReplies(t)))await o.delete(`comment:${e.id}`);return await o.delete(`comment:${t}`),!0}},I={async create(t){let e={...t,id:(0,l.Z)(),createdAt:new Date().toISOString()};return await o.set(`quote:${e.id}`,e),e},async getByProduct(t){let e=await o.list("quote:"),a=[];for(let i of e){let e=await o.get(i);e&&e.productId===t&&a.push(e)}return a.sort((t,e)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())},async getBySeller(t){let e=await o.list("quote:"),a=[];for(let i of e){let e=await o.get(i);if(e){let i=await u.findById(e.productId);i&&i.merchantId===t&&a.push(e)}}return a.sort((t,e)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())}},A={async create(t){let e={...t,id:(0,l.Z)(),excerpt:t.excerpt||t.content.substring(0,200)+"...",readTime:t.readTime||Math.ceil(t.content.length/1e3)};return await o.set(`insight:${e.id}`,e),e},findById:async t=>await o.get(`insight:${t}`),async getAll(){let t=await o.list("insight:"),e=[];for(let a of t){let t=await o.get(a);t&&e.push(t)}return e.sort((t,e)=>new Date(e.publishedAt).getTime()-new Date(t.publishedAt).getTime())},async getFeatured(){return(await this.getAll()).find(t=>t.featured)||null},async getByTag(t){return(await this.getAll()).filter(e=>e.tags.includes(t))},async update(t,e){let a=await this.findById(t);if(!a)return null;let i={...a,...e};return await o.set(`insight:${t}`,i),i}},$={async create(t){let e={...t,id:(0,l.Z)(),title:t.title||t.serviceType,createdAt:new Date().toISOString()};return await o.set(`service:${e.id}`,e),e},findById:async t=>await o.get(`service:${t}`),async getAll(){let t=await o.list("service:"),e=[];for(let a of t){let t=await o.get(a);t&&"active"===t.status&&e.push(t)}return e.sort((t,e)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())},async findByProvider(t){let e=await o.list("service:"),a=[];for(let i of e){let e=await o.get(i);e&&e.providerId===t&&a.push(e)}return a.sort((t,e)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())},async archive(t){await this.findById(t)&&await o.delete(`service:${t}`)}};async function b(){if(0===(await A.getAll()).length)for(let t of[{title:"The Future of Renewable Energy in Oil & Gas",content:"The oil and gas industry is undergoing a significant transformation as companies increasingly adopt renewable energy technologies. This shift is driven by environmental regulations, investor pressure, and the economic viability of clean energy solutions. Companies are investing heavily in solar, wind, and hydrogen technologies to reduce their carbon footprint and prepare for a sustainable future. The integration of these technologies with traditional operations presents both challenges and opportunities for industry leaders.",imageUrl:"/attached_assets/images/renewable-energy.jpg",author:"Dr. Sarah Mitchell",publishedAt:"2024-01-15T10:00:00Z",featured:!0,excerpt:"Exploring how oil and gas companies are embracing renewable energy technologies to create a more sustainable future.",tags:["renewable","sustainability","technology","future"],readTime:5},{title:"Digital Transformation in Upstream Operations",content:"Digital technologies are revolutionizing upstream oil and gas operations. From IoT sensors on drilling rigs to AI-powered predictive maintenance, companies are leveraging technology to improve efficiency, reduce costs, and enhance safety. Machine learning algorithms can now predict equipment failures before they occur, while digital twins provide virtual representations of physical assets for better decision-making.",imageUrl:"/attached_assets/images/digital-transformation.jpg",author:"Mark Thompson",publishedAt:"2024-01-10T14:30:00Z",featured:!1,excerpt:"How digital technologies are transforming upstream operations and improving efficiency across the industry.",tags:["digital","upstream","technology","AI"],readTime:4}])try{await A.create(t)}catch(e){console.log("Sample insight already exists:",t.title)}}let v={async getAll(){let t=await o.list("category:"),e=[];for(let a of t){let t=await o.get(a);t&&e.push(t)}return e},async create(t){let e={...t,id:(0,l.Z)()};return await o.set(`category:${e.id}`,e),e},async update(t,e){let a=await o.get(`category:${t}`);if(!a)return null;let i={...a,...e};return await o.set(`category:${t}`,i),i},delete:async t=>!!await o.get(`category:${t}`)&&(await o.delete(`category:${t}`),!0),async archive(t){let e=await o.get(`category:${t}`);if(!e)return!1;let a={...e,archived:!0};return await o.set(`category:${t}`,a),!0}},B=o}};